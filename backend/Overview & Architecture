Real-Time Collaborative Workspace Backend
ğŸ“Œ Overview

This project is a production-grade backend service for a real-time collaborative workspace (similar to a simplified collaborative coding platform).

It is designed with scalability, security, and real-time communication as first-class concerns.

The system supports:

Secure authentication & authorization

Project & workspace management

Real-time collaboration via WebSockets

Kafka-based event streaming

Asynchronous background job processing

Audit & activity logging

Cloud-ready containerized deployment

ğŸ—ï¸ High-Level Architecture
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Clients â”‚
â”‚ (Web / API) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
REST + WebSocket
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server â”‚
â”‚ (Node.js + Express) â”‚
â”‚ â”‚
â”‚ - Auth (JWT + RBAC) â”‚
â”‚ - Projects / Workspaces â”‚
â”‚ - WebSockets â”‚
â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚
Produce â”‚ â”‚ Consume
â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ Kafka â”‚
â”‚ (Event Backbone) â”‚
â”‚ â”‚
â”‚ - workspace-events â”‚
â”‚ - job-events â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WS Broadcasterâ”‚ â”‚ Job Worker â”‚
â”‚ (Kafka Consumer) â”‚ â”‚ (Kafka Consumer)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Datastores â”‚
â”‚ â”‚
â”‚ PostgreSQL â†’ Core Data â”‚
â”‚ MongoDB â†’ Activity Logs â”‚
â”‚ Redis â†’ Cache / RateLimitâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ§± Tech Stack
Backend

Node.js + TypeScript

Express.js

Socket.IO (real-time communication)

Messaging & Streaming

Apache Kafka (KafkaJS)

Event backbone

Real-time fan-out

Async jobs

Databases

PostgreSQL (Prisma ORM)

Users, Projects, Workspaces, Jobs

MongoDB

Activity logs & audit trail

Redis

Caching, rate-limiting

Infrastructure

Docker & Docker Compose

JWT Authentication

RBAC (Owner / Collaborator / Viewer)

ğŸ” Authentication & Authorization
Authentication

JWT access tokens (short-lived)

Refresh tokens (DB-stored & rotated)

Token revocation on logout

Authorization

Workspace-scoped RBAC

Permission-based access

Enforced at application layer

Roles

Role Permissions
OWNER Admin + Write + Read
COLLABORATOR Write + Read
VIEWER Read
ğŸ“‚ Domain-Driven Design (Clean Architecture)
src/
â”œâ”€â”€ domain/ # Pure business models
â”œâ”€â”€ application/ # Use cases
â”œâ”€â”€ infrastructure/ # DB, Kafka, Redis, Mongo
â”œâ”€â”€ interfaces/ # HTTP & WebSocket APIs
â”œâ”€â”€ shared/ # Utilities & types

Benefits

Clear separation of concerns

Testability

Scalability

Easy refactoring

âš¡ Real-Time Collaboration

WebSockets authenticated using JWT

Workspace-scoped rooms

Events:

User join / leave

File changes (mocked payloads)

Kafka used to:

Broadcast events across instances

Guarantee ordering per workspace

Enable horizontal scaling

ğŸ” Asynchronous Jobs

Jobs submitted via REST API

Kafka used as job queue

Worker processes jobs independently

Job lifecycle:

PENDING â†’ RUNNING â†’ SUCCESS / FAILED

Idempotency enforced via database

Job status persisted in PostgreSQL

Job events logged to MongoDB

ğŸ“ Activity & Audit Logs

MongoDB used for write-heavy activity logs

Logged events:

Workspace joins/leaves

File updates

Job success/failure

Kafka consumers persist logs

Activity feed available via API

---------------------------------------------------------

Clients
 â”œâ”€ REST APIs (HTTP)
 â”œâ”€ WebSockets (Realtime)
 |
API Gateway / Backend Service (Node.js)
 â”œâ”€ Auth & RBAC
 â”œâ”€ Project / Workspace APIs
 â”œâ”€ WebSocket Gateway
 â”œâ”€ Job Dispatcher
 |
 â”œâ”€ PostgreSQL (Relational Data)
 â”œâ”€ Redis (Cache + Pub/Sub),Kafka,RabbitMQ
 â”œâ”€ MongoDB (Events / Logs)
 |
Background Workers
 â”œâ”€ Job Processing
 â”œâ”€ Retry & Failure Handling



-------------------------------------------------------------------------------ARCHITECTURE------------------------------------------------------------------------


                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Client    â”‚
                â”‚ (Web / App) â”‚
                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
          REST APIs    â”‚    WebSockets
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     API Gateway / App     â”‚
        â”‚   Node.js + Express.js    â”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚           â”‚
       PostgreSQL     WebSocket Server
              â”‚           â”‚
          Redis Cache  Redis Pub/Sub
              â”‚           â”‚
          MongoDB     Message Broker
                              â”‚
                        Background Workers


--------------------------------------------------------------------Domain Relationships (ER Diagram)---------------------------------------

User â”€â”€â”¬â”€â”€ Project â”€â”€ Workspace â”€â”€ WorkspaceMembers
       â”‚
       â””â”€â”€ Jobs â”€â”€ JobAttempts



---------------------------------------------------------------------------------------Clean Architecture----------------------------------------------------------------------------------




â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Presentation Layer     â”‚  â†’ Controllers / Routes
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Application Layer      â”‚  â†’ Use cases / Services
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Domain Layer         â”‚  â†’ Entities, rules
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Infrastructure Layer    â”‚  â†’ DB, Redis, MQ, WebSocket
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜



---------------------------------------------------------------------Final Backend Folder Structure---------------------------------------------------------------





backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/              # env, constants, feature flags
â”‚   â”‚   â”œâ”€â”€ env.ts
â”‚   â”‚   â”œâ”€â”€ redis.ts
â”‚   â”‚   â”œâ”€â”€ logger.ts
â”‚   â”‚   â””â”€â”€ rateLimiter.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/              # PURE business logic
â”‚   â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”‚   â”œâ”€â”€ user.entity.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.types.ts
â”‚   â”‚   â”œâ”€â”€ project/
â”‚   â”‚   â”œâ”€â”€ workspace/
â”‚   â”‚   â””â”€â”€ job/
â”‚   â”‚
â”‚   â”œâ”€â”€ application/         # Use cases
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ login.usecase.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ refreshToken.usecase.ts
â”‚   â”‚   â”œâ”€â”€ project/
â”‚   â”‚   â”œâ”€â”€ workspace/
â”‚   â”‚   â””â”€â”€ job/
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/      # External services
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â”œâ”€â”€ prisma.ts
â”‚   â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ mongo/
â”‚   â”‚   â”œâ”€â”€ redis/
â”‚   â”‚   â”œâ”€â”€ queue/
â”‚   â”‚   â””â”€â”€ websocket/
â”‚   â”‚
â”‚   â”œâ”€â”€ interfaces/          # API layer
â”‚   â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â””â”€â”€ middlewares/
â”‚   â”‚   â””â”€â”€ websocket/
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/              # Common utilities
â”‚   â”‚   â”œâ”€â”€ errors/
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚
â”‚   â”œâ”€â”€ app.ts               # express app
â”‚   â””â”€â”€ server.ts            # entry point
â”‚
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”‚
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md



---------------------------------------------------------------------------Auth Flow------------------------------------------------------------------------------------

Login
 â”œâ”€ verify credentials
 â”œâ”€ issue ACCESS_TOKEN (short-lived)
 â””â”€ issue REFRESH_TOKEN (long-lived, stored hashed in DB)

Request
 â”œâ”€ client sends ACCESS_TOKEN
 â””â”€ auth middleware validates

Refresh
 â”œâ”€ client sends REFRESH_TOKEN
 â”œâ”€ old token revoked
 â””â”€ new token issued


------------------------------------------------------------------------------Real-Time Architecture-----------------------------------------------------------



Client
  â”‚
  â”‚ WebSocket (JWT)
  â–¼
Node WS Server
  â”‚
  â”œâ”€ Broadcast locally
  â””â”€ Publish to Redis
         â”‚
         â–¼
   Other WS Servers

   -----------------------------------------------------------------------------High Level Design-----------------------------------------------------------------------------------

Producer â†’ Kafka Topic
              â†“
        Consumer (Job Handler)
              â†“
     â”Œâ”€â”€ Success â†’ Commit offset
     â”‚
     â””â”€â”€ Failure
          â”œâ”€ Retry (with backoff)
          â”œâ”€ Check idempotency
          â””â”€ Max retries â†’ DLQ

------------------------------------------


Client (WebSocket)
   |
Node API Server
   |
   | produce events
   v
Kafka Topic (workspace-events)
   |
   | consume events
   v
WebSocket Broadcaster / Workers





----------------------------------------------------------------------Kafka Architecture--------------------------------------------------------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Zookeeper  â”‚  â† metadata, leader election
â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚   Kafka    â”‚  â† workspace-events, job-events
â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node.js Backend    â”‚
â”‚ (producer/consumer)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


-----------------------------------------OVERALL REAL-TIME FLOW---------------------------------------------

HTTP (Postman)           WebSocket (Real-time)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Create Workspace   â†’    Join Workspace Socket
Invite User        â†’    Presence Updates
Create Project     â†’    Live Events
Assign Roles       â†’    Permissions Sync
Emit Events        â†’    Kafka â†’ Workers â†’ Broadcast


-------------------------------- Testing order logically --------------------

### API Testing Flow (IMPORTANT)

## You must test APIs in a logical order, not randomly.

# ğŸ” Test Sequence

1.Auth
-Register
-Login â†’ Save token

2.Workspace
-Create workspace
-Invite user

3.Project
-Create project

4.Activity
-MongoDB audit logs appear

5.Jobs
-Create job
-Kafka consumes â†’ worker processes

6.RBAC
-Redis permissions cached

